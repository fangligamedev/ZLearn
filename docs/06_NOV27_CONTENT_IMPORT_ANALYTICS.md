# ZLearn 11æœˆ27æ—¥å¼€å‘è®¡åˆ’
## å†…å®¹å¯¼å…¥ + æ•°æ®åˆ†æç³»ç»Ÿ

> **æ—¥æœŸ**: 2025-11-27  
> **é¢„ä¼°æ—¶é—´**: 6-8 å°æ—¶  
> **æ ¸å¿ƒç›®æ ‡**: ç”¨æˆ·è‡ªå®šä¹‰è¯¾ç¨‹ç”Ÿæˆ + å­¦ä¹ æ•°æ®æŒä¹…åŒ–åˆ†æ

---

## ğŸ“‹ å½“å‰è¿›åº¦æ€»ç»“

### âœ… å·²å®ŒæˆåŠŸèƒ½ (MVP Demo)
- Zeabur è¯¾ç¨‹: 10 å¼ åœ°å›¾ã€100 å…³å¡ï¼ŒæŒ‰åœ°å›¾/éš¾åº¦ç­›é€‰
- æ¦‚å¿µé¢˜å‹: å•é€‰/åˆ¤æ–­/å¡«ç©ºï¼ŒæŒ‰å°è¯•æ¬¡æ•°é™æ˜Ÿè¯„åˆ†
- èŠå¤©æ•™ç»ƒ: ä¸“ä¸šä¸¥è°¨å‹ + ç¾å˜‰éŸ³è‰²ï¼Œè‡ªåŠ¨æ³¨å…¥é¢˜ç›®ä¸Šä¸‹æ–‡
- å¤ç›˜é¢æ¿: å®Œæˆå…³å¡/æ˜Ÿæ•°/æ­£ç¡®ç‡/é”™é¢˜åˆ—è¡¨/æ˜¨æ—¥å­¦ä¹ æ—¶é•¿
- TTS/å¡«ç©ºæ˜¾ç¤ºä¿®å¤ï¼Œæ„å»ºé¢„è§ˆå¯ç”¨

### ğŸ¯ ä»Šæ—¥å¼€å‘ç›®æ ‡
1. **å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ** - ç”¨æˆ·å¯å¯¼å…¥ PDF/MD/ç½‘é¡µç”Ÿæˆè‡ªå®šä¹‰è¯¾ç¨‹
2. **æ¸¸æˆåŒ–é…ç½®ç³»ç»Ÿ** - å…³å¡/è¯¾ç¨‹å‚æ•°é€šè¿‡ JSON é…ç½®æ–‡ä»¶æš´éœ²ï¼Œå¯çµæ´»è°ƒæ•´
3. **æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ** - æ¸¸æˆåŒ–åŸ‹ç‚¹ + ç•™å­˜åˆ†æ + Zeabur æ•°æ®å¤‡ä»½

---

## ğŸš€ å¼€å‘è®¡åˆ’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NOV 27 DEVELOPMENT PLAN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  PHASE A: å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ                        Est: 3-4 hours  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  Step A.1: å¯¼å…¥æœåŠ¡æ ¸å¿ƒ (PDF/MD/URL)                                â”‚
â”‚  Step A.2: AI è¯¾ç¨‹ç”ŸæˆæœåŠ¡                                          â”‚
â”‚  Step A.3: è¯¾ç¨‹åˆ›å»ºå‘å¯¼ UI                                          â”‚
â”‚  Step A.4: åŠ¨æ€è¯¾ç¨‹ç®¡ç†                                             â”‚
â”‚                                                                     â”‚
â”‚  PHASE C: æ¸¸æˆåŒ–é…ç½®ç³»ç»Ÿ                            Est: 2-3 hours  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  Step C.1: è¯¾ç¨‹/å…³å¡é…ç½®æ–‡ä»¶è®¾è®¡                                    â”‚
â”‚  Step C.2: é…ç½®æœåŠ¡ (configService)                                 â”‚
â”‚  Step C.3: é…ç½®çƒ­åŠ è½½ä¸è¿è¡Œæ—¶è¦†ç›–                                   â”‚
â”‚  Step C.4: é…ç½®ç¼–è¾‘å™¨ UI (å¯é€‰)                                     â”‚
â”‚                                                                     â”‚
â”‚  PHASE B: æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ                          Est: 3-4 hours  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  Step B.1: IndexedDB å­˜å‚¨æœåŠ¡                                       â”‚
â”‚  Step B.2: åŸ‹ç‚¹äº‹ä»¶æ”¶é›†                                             â”‚
â”‚  Step B.3: ç•™å­˜/å­¦ä¹ åˆ†æå¼•æ“                                         â”‚
â”‚  Step B.4: Zeabur æ•°æ®å¤‡ä»½æ–¹æ¡ˆ                                      â”‚
â”‚                                                                     â”‚
â”‚                                          Total Est: 8-11 hours     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# PHASE A: å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ

## A.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONTENT IMPORT FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ç”¨æˆ·è¾“å…¥                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“„ PDFä¸Šä¼   |  ğŸ“ Markdownç²˜è´´  |  ğŸŒ ç½‘é¡µURL              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“Š è¯¾ç¨‹é…ç½®é¢æ¿                                             â”‚  â”‚
â”‚   â”‚  â€¢ åœ°å›¾æ•°é‡: [1-10]  æ»‘å—                                    â”‚  â”‚
â”‚   â”‚  â€¢ æ¯åœ°å›¾å…³å¡: [5-20] æ»‘å—                                   â”‚  â”‚
â”‚   â”‚  â€¢ éš¾åº¦åˆ†å¸ƒ: [å‡åŒ€/é€’å¢/éšæœº]                                 â”‚  â”‚
â”‚   â”‚  â€¢ åšé¢˜æ¨¡å¼: [é¡ºåº/éšæœº/è‡ªé€‚åº”]                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ¤– AI è¯¾ç¨‹ç”Ÿæˆ                                              â”‚  â”‚
â”‚   â”‚  1. å†…å®¹è§£æ â†’ çŸ¥è¯†ç‚¹æå–                                     â”‚  â”‚
â”‚   â”‚  2. éš¾åº¦è¯„ä¼° â†’ å…³å¡åˆ†é…                                       â”‚  â”‚
â”‚   â”‚  3. é¢˜ç›®ç”Ÿæˆ â†’ å¤šé¢˜å‹åˆ†å¸ƒ                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“š è‡ªå®šä¹‰è¯¾ç¨‹ (ä¸ Python/Zeabur å¹³è¡Œ)                       â”‚  â”‚
â”‚   â”‚  â€¢ æ˜¾ç¤ºåœ¨è¯¾ç¨‹åˆ‡æ¢ Tab                                        â”‚  â”‚
â”‚   â”‚  â€¢ ç‹¬ç«‹è¿›åº¦è¿½è¸ª                                               â”‚  â”‚
â”‚   â”‚  â€¢ å¯ç¼–è¾‘/åˆ é™¤                                                â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step A.1: å¯¼å…¥æœåŠ¡æ ¸å¿ƒ

### ğŸ“¥ Input
- PDF æ–‡ä»¶ (é€šè¿‡ FileReader)
- Markdown æ–‡æœ¬
- ç½‘é¡µ URL (é€šè¿‡ Jina Reader API)

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/importService.ts
// ============================================================

export interface ImportSource {
  type: 'pdf' | 'markdown' | 'url';
  content: string | File;
  name?: string;
}

export interface ImportResult {
  success: boolean;
  text: string;
  metadata: {
    title: string;
    wordCount: number;
    estimatedTokens: number;
  };
  error?: string;
}

class ImportService {
  /**
   * PDF è§£æ (ä½¿ç”¨ pdf.js)
   */
  async parsePDF(file: File): Promise<ImportResult> {
    // ä½¿ç”¨ pdfjs-dist åº“æå–æ–‡æœ¬
    const pdfjsLib = await import('pdfjs-dist');
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    
    let fullText = '';
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const pageText = content.items.map((item: any) => item.str).join(' ');
      fullText += pageText + '\n\n';
    }
    
    return {
      success: true,
      text: fullText,
      metadata: {
        title: file.name.replace('.pdf', ''),
        wordCount: fullText.split(/\s+/).length,
        estimatedTokens: Math.round(fullText.length / 4)
      }
    };
  }

  /**
   * Markdown è§£æ
   */
  parseMarkdown(content: string, name?: string): ImportResult {
    // æå–æ ‡é¢˜
    const titleMatch = content.match(/^#\s+(.+)$/m);
    const title = titleMatch ? titleMatch[1] : name || 'æœªå‘½åæ–‡æ¡£';
    
    // ç§»é™¤ Markdown è¯­æ³•ï¼Œä¿ç•™çº¯æ–‡æœ¬
    const plainText = content
      .replace(/```[\s\S]*?```/g, '') // ç§»é™¤ä»£ç å—
      .replace(/`[^`]+`/g, '')        // ç§»é™¤è¡Œå†…ä»£ç 
      .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // é“¾æ¥ â†’ æ–‡æœ¬
      .replace(/[#*_~>`]/g, '')       // ç§»é™¤æ ‡è®°ç¬¦å·
      .trim();
    
    return {
      success: true,
      text: plainText,
      metadata: {
        title,
        wordCount: plainText.split(/\s+/).length,
        estimatedTokens: Math.round(plainText.length / 4)
      }
    };
  }

  /**
   * ç½‘é¡µæŠ“å– (Jina Reader API)
   */
  async fetchURL(url: string): Promise<ImportResult> {
    try {
      const readerUrl = `https://r.jina.ai/${url}`;
      const response = await fetch(readerUrl, {
        headers: { 'Accept': 'text/markdown' }
      });
      
      if (!response.ok) {
        throw new Error(`æŠ“å–å¤±è´¥: ${response.status}`);
      }
      
      const markdown = await response.text();
      return this.parseMarkdown(markdown, new URL(url).hostname);
    } catch (error) {
      return {
        success: false,
        text: '',
        metadata: { title: '', wordCount: 0, estimatedTokens: 0 },
        error: error instanceof Error ? error.message : 'ç½‘é¡µæŠ“å–å¤±è´¥'
      };
    }
  }

  /**
   * ç»Ÿä¸€å¯¼å…¥å…¥å£
   */
  async import(source: ImportSource): Promise<ImportResult> {
    switch (source.type) {
      case 'pdf':
        return this.parsePDF(source.content as File);
      case 'markdown':
        return this.parseMarkdown(source.content as string, source.name);
      case 'url':
        return this.fetchURL(source.content as string);
      default:
        return {
          success: false,
          text: '',
          metadata: { title: '', wordCount: 0, estimatedTokens: 0 },
          error: 'ä¸æ”¯æŒçš„å¯¼å…¥ç±»å‹'
        };
    }
  }
}

export const importService = new ImportService();
```

### ğŸ“¤ Output
- `src/services/importService.ts`

### âœ… éªŒæ”¶æ ‡å‡†
- PDF æ–‡ä»¶å¯æˆåŠŸè§£æä¸ºæ–‡æœ¬
- Markdown å†…å®¹å¯æ­£ç¡®æå–
- URL é€šè¿‡ Jina Reader è·å–å†…å®¹

---

## Step A.2: AI è¯¾ç¨‹ç”ŸæˆæœåŠ¡

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/courseGeneratorService.ts
// ============================================================

import { Course, ConceptLevel, ConceptQuestion } from '../types';

/** è¯¾ç¨‹ç”Ÿæˆé…ç½® */
export interface CourseGenerationConfig {
  mapCount: number;          // åœ°å›¾æ•°é‡ (1-10)
  levelsPerMap: number;      // æ¯åœ°å›¾å…³å¡æ•° (5-20)
  difficultyMode: 'uniform' | 'progressive' | 'random';  // éš¾åº¦åˆ†å¸ƒ
  questionMode: 'sequential' | 'random' | 'adaptive';    // åšé¢˜æ¨¡å¼
  questionTypes: ('single_choice' | 'true_false' | 'fill_blank')[]; // é¢˜å‹
}

/** é»˜è®¤é…ç½® */
export const DEFAULT_CONFIG: CourseGenerationConfig = {
  mapCount: 3,
  levelsPerMap: 10,
  difficultyMode: 'progressive',
  questionMode: 'sequential',
  questionTypes: ['single_choice', 'true_false', 'fill_blank']
};

class CourseGeneratorService {
  /**
   * ç”Ÿæˆè¯¾ç¨‹ Prompt
   */
  private buildPrompt(
    content: string,
    config: CourseGenerationConfig,
    mapIndex: number
  ): string {
    const totalLevels = config.levelsPerMap;
    const difficultyDesc = {
      uniform: 'æ‰€æœ‰é¢˜ç›®éš¾åº¦å‡åŒ€åˆ†å¸ƒ',
      progressive: 'éš¾åº¦ä»æ˜“åˆ°éš¾é€’å¢',
      random: 'éš¾åº¦éšæœºåˆ†å¸ƒ'
    }[config.difficultyMode];

    return `
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ•™è‚²å†…å®¹è®¾è®¡å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ææ–™ç”Ÿæˆå­¦ä¹ å…³å¡ã€‚

ã€è¾“å…¥ææ–™ã€‘
${content.slice(0, 8000)} // é™åˆ¶ Token

ã€ç”Ÿæˆè¦æ±‚ã€‘
1. ç”Ÿæˆ ${totalLevels} ä¸ªå…³å¡
2. è¿™æ˜¯ç¬¬ ${mapIndex + 1} å¼ åœ°å›¾
3. éš¾åº¦åˆ†å¸ƒ: ${difficultyDesc}
4. é¢˜å‹åˆ†å¸ƒ: ${config.questionTypes.join('ã€')}
5. æ¯ä¸ªå…³å¡ 1 é“æ ¸å¿ƒé¢˜ç›®

ã€è¾“å‡ºæ ¼å¼ (ä¸¥æ ¼ JSON)ã€‘
{
  "mapTitle": "åœ°å›¾åç§°",
  "mapDescription": "åœ°å›¾æè¿°",
  "levels": [
    {
      "id": 1,
      "title": "å…³å¡æ ‡é¢˜",
      "difficulty": "easy|medium|hard",
      "question": {
        "type": "single_choice",
        "question": "é—®é¢˜æ–‡æœ¬",
        "options": [
          {"key": "A", "text": "é€‰é¡¹A"},
          {"key": "B", "text": "é€‰é¡¹B"},
          {"key": "C", "text": "é€‰é¡¹C"},
          {"key": "D", "text": "é€‰é¡¹D"}
        ],
        "correctAnswer": "B",
        "explanation": "è§£é‡Šè¯´æ˜"
      }
    }
  ]
}

æ³¨æ„:
- type ä¸º true_false æ—¶ï¼Œä½¿ç”¨ statement + correctAnswer (boolean)
- type ä¸º fill_blank æ—¶ï¼Œä½¿ç”¨ question (å«____) + correctAnswers (æ•°ç»„)
`;
  }

  /**
   * è°ƒç”¨ AI ç”Ÿæˆå•å¼ åœ°å›¾
   */
  async generateMap(
    content: string,
    config: CourseGenerationConfig,
    mapIndex: number
  ): Promise<{
    mapTitle: string;
    mapDescription: string;
    levels: ConceptLevel[];
  }> {
    const prompt = this.buildPrompt(content, config, mapIndex);
    
    // è°ƒç”¨ Gemini API
    const response = await fetch('https://hnd1.aihub.zeabur.ai/gemini/v1beta/models/gemini-2.0-flash:generateContent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${process.env.GEMINI_API_KEY}`
      },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
          temperature: 0.7,
          maxOutputTokens: 4096,
          responseMimeType: 'application/json'
        }
      })
    });

    const data = await response.json();
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '{}';
    
    // æ¸…ç†å¹¶è§£æ JSON
    const cleanText = text.replace(/```json\n?|\n?```/g, '').trim();
    return JSON.parse(cleanText);
  }

  /**
   * ç”Ÿæˆå®Œæ•´è¯¾ç¨‹
   */
  async generateCourse(
    content: string,
    courseName: string,
    config: CourseGenerationConfig,
    onProgress?: (current: number, total: number) => void
  ): Promise<Course> {
    const maps: { title: string; description: string; levels: ConceptLevel[] }[] = [];
    
    // åˆ†å—å†…å®¹ç”¨äºä¸åŒåœ°å›¾
    const chunkSize = Math.ceil(content.length / config.mapCount);
    
    for (let i = 0; i < config.mapCount; i++) {
      const chunk = content.slice(i * chunkSize, (i + 1) * chunkSize);
      onProgress?.(i + 1, config.mapCount);
      
      try {
        const mapData = await this.generateMap(chunk, config, i);
        
        // é‡æ–°ç¼–å·å…³å¡ ID
        const baseId = i * config.levelsPerMap;
        mapData.levels = mapData.levels.map((level, idx) => ({
          ...level,
          id: baseId + idx + 1,
          mapIndex: i,
          mapTitle: mapData.mapTitle
        }));
        
        maps.push({
          title: mapData.mapTitle,
          description: mapData.mapDescription,
          levels: mapData.levels
        });
      } catch (error) {
        console.error(`åœ°å›¾ ${i + 1} ç”Ÿæˆå¤±è´¥:`, error);
      }
      
      // é¿å… API é™æµ
      await new Promise(r => setTimeout(r, 1000));
    }

    // ç»„è£…è¯¾ç¨‹
    const allLevels = maps.flatMap(m => m.levels);
    
    return {
      id: `custom-${Date.now()}`,
      name: courseName,
      icon: 'ğŸ“š',
      description: `è‡ªå®šä¹‰è¯¾ç¨‹ - ${config.mapCount} å¼ åœ°å›¾ï¼Œ${allLevels.length} ä¸ªå…³å¡`,
      type: 'concept',
      maps: maps.map((m, i) => ({
        id: i,
        title: m.title,
        description: m.description,
        levelCount: m.levels.length
      })),
      levels: allLevels,
      config: config,
      createdAt: new Date().toISOString(),
      isCustom: true
    };
  }
}

export const courseGeneratorService = new CourseGeneratorService();
```

### ğŸ“¤ Output
- `src/services/courseGeneratorService.ts`

---

## Step A.3: è¯¾ç¨‹åˆ›å»ºå‘å¯¼ UI

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/components/course/CourseCreator.tsx
// ============================================================

import React, { useState } from 'react';
import { importService, ImportResult } from '../../services/importService';
import { courseGeneratorService, CourseGenerationConfig, DEFAULT_CONFIG } from '../../services/courseGeneratorService';
import { Course } from '../../types';

interface CourseCreatorProps {
  onComplete: (course: Course) => void;
  onCancel: () => void;
}

type Step = 'import' | 'configure' | 'generate' | 'complete';

const CourseCreator: React.FC<CourseCreatorProps> = ({ onComplete, onCancel }) => {
  const [step, setStep] = useState<Step>('import');
  const [importResult, setImportResult] = useState<ImportResult | null>(null);
  const [config, setConfig] = useState<CourseGenerationConfig>(DEFAULT_CONFIG);
  const [courseName, setCourseName] = useState('');
  const [generating, setGenerating] = useState(false);
  const [progress, setProgress] = useState({ current: 0, total: 0 });

  // === å¯¼å…¥å¤„ç† ===
  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    const result = await importService.import({ type: 'pdf', content: file });
    setImportResult(result);
    setCourseName(result.metadata.title);
  };

  const handleMarkdownPaste = (text: string) => {
    const result = importService.parseMarkdown(text);
    setImportResult(result);
    setCourseName(result.metadata.title || 'è‡ªå®šä¹‰è¯¾ç¨‹');
  };

  const handleURLFetch = async (url: string) => {
    const result = await importService.import({ type: 'url', content: url });
    setImportResult(result);
    setCourseName(result.metadata.title);
  };

  // === ç”Ÿæˆè¯¾ç¨‹ ===
  const handleGenerate = async () => {
    if (!importResult?.text) return;
    
    setGenerating(true);
    setStep('generate');
    
    try {
      const course = await courseGeneratorService.generateCourse(
        importResult.text,
        courseName,
        config,
        (current, total) => setProgress({ current, total })
      );
      
      // ä¿å­˜åˆ° localStorage
      const customCourses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
      customCourses.push(course);
      localStorage.setItem('zlearn_custom_courses', JSON.stringify(customCourses));
      
      setStep('complete');
      onComplete(course);
    } catch (error) {
      console.error('è¯¾ç¨‹ç”Ÿæˆå¤±è´¥:', error);
    } finally {
      setGenerating(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
      <div className="bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        
        {/* æ ‡é¢˜æ  */}
        <div className="p-6 border-b border-slate-700">
          <h2 className="text-2xl font-bold">âœ¨ åˆ›å»ºè‡ªå®šä¹‰è¯¾ç¨‹</h2>
          <p className="text-slate-400 mt-1">å¯¼å…¥å†…å®¹ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆé—¯å…³é¢˜ç›®</p>
        </div>

        {/* Step 1: å¯¼å…¥ */}
        {step === 'import' && (
          <div className="p-6 space-y-6">
            {/* PDF ä¸Šä¼  */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸ“„ ä¸Šä¼  PDF æ–‡æ¡£</label>
              <input
                type="file"
                accept=".pdf"
                onChange={handleFileUpload}
                className="w-full p-3 bg-slate-700 rounded-xl file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-blue-600 file:text-white"
              />
            </div>

            {/* Markdown ç²˜è´´ */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸ“ ç²˜è´´ Markdown å†…å®¹</label>
              <textarea
                rows={4}
                placeholder="åœ¨æ­¤ç²˜è´´ Markdown æ–‡æœ¬..."
                onChange={(e) => handleMarkdownPaste(e.target.value)}
                className="w-full p-3 bg-slate-700 rounded-xl resize-none"
              />
            </div>

            {/* URL è¾“å…¥ */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸŒ è¾“å…¥ç½‘é¡µ URL</label>
              <div className="flex gap-2">
                <input
                  type="url"
                  placeholder="https://example.com/docs"
                  className="flex-1 p-3 bg-slate-700 rounded-xl"
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      handleURLFetch((e.target as HTMLInputElement).value);
                    }
                  }}
                />
                <button
                  onClick={() => {
                    const input = document.querySelector('input[type="url"]') as HTMLInputElement;
                    if (input?.value) handleURLFetch(input.value);
                  }}
                  className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-xl"
                >
                  æŠ“å–
                </button>
              </div>
            </div>

            {/* å¯¼å…¥ç»“æœé¢„è§ˆ */}
            {importResult && (
              <div className="p-4 bg-slate-700/50 rounded-xl">
                <div className="flex items-center gap-2 text-green-400 mb-2">
                  <span>âœ“</span>
                  <span className="font-medium">{importResult.metadata.title}</span>
                </div>
                <div className="text-sm text-slate-400">
                  çº¦ {importResult.metadata.wordCount} å­— Â· 
                  é¢„ä¼° {importResult.metadata.estimatedTokens} Token
                </div>
              </div>
            )}

            {/* ä¸‹ä¸€æ­¥æŒ‰é’® */}
            <div className="flex gap-3">
              <button
                onClick={onCancel}
                className="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={() => setStep('configure')}
                disabled={!importResult?.success}
                className="flex-1 py-3 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 rounded-xl font-bold"
              >
                ä¸‹ä¸€æ­¥: é…ç½®è¯¾ç¨‹
              </button>
            </div>
          </div>
        )}

        {/* Step 2: é…ç½® */}
        {step === 'configure' && (
          <div className="p-6 space-y-6">
            {/* è¯¾ç¨‹åç§° */}
            <div>
              <label className="block text-sm font-medium mb-2">è¯¾ç¨‹åç§°</label>
              <input
                type="text"
                value={courseName}
                onChange={(e) => setCourseName(e.target.value)}
                className="w-full p-3 bg-slate-700 rounded-xl"
              />
            </div>

            {/* åœ°å›¾æ•°é‡ */}
            <div>
              <label className="block text-sm font-medium mb-2">
                åœ°å›¾æ•°é‡: <span className="text-blue-400">{config.mapCount}</span>
              </label>
              <input
                type="range"
                min={1}
                max={10}
                value={config.mapCount}
                onChange={(e) => setConfig({ ...config, mapCount: Number(e.target.value) })}
                className="w-full"
              />
              <div className="flex justify-between text-xs text-slate-500">
                <span>1</span>
                <span>10</span>
              </div>
            </div>

            {/* æ¯åœ°å›¾å…³å¡æ•° */}
            <div>
              <label className="block text-sm font-medium mb-2">
                æ¯åœ°å›¾å…³å¡: <span className="text-blue-400">{config.levelsPerMap}</span>
              </label>
              <input
                type="range"
                min={5}
                max={20}
                value={config.levelsPerMap}
                onChange={(e) => setConfig({ ...config, levelsPerMap: Number(e.target.value) })}
                className="w-full"
              />
              <div className="flex justify-between text-xs text-slate-500">
                <span>5</span>
                <span>20</span>
              </div>
            </div>

            {/* éš¾åº¦åˆ†å¸ƒ */}
            <div>
              <label className="block text-sm font-medium mb-2">éš¾åº¦åˆ†å¸ƒæ¨¡å¼</label>
              <div className="grid grid-cols-3 gap-2">
                {[
                  { value: 'uniform', label: 'å‡åŒ€', icon: 'âš–ï¸' },
                  { value: 'progressive', label: 'é€’å¢', icon: 'ğŸ“ˆ' },
                  { value: 'random', label: 'éšæœº', icon: 'ğŸ²' }
                ].map(opt => (
                  <button
                    key={opt.value}
                    onClick={() => setConfig({ ...config, difficultyMode: opt.value as any })}
                    className={`p-3 rounded-xl text-center transition-all ${
                      config.difficultyMode === opt.value
                        ? 'bg-blue-600 ring-2 ring-blue-400'
                        : 'bg-slate-700 hover:bg-slate-600'
                    }`}
                  >
                    <span className="text-xl block mb-1">{opt.icon}</span>
                    <span className="text-sm">{opt.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* åšé¢˜æ¨¡å¼ */}
            <div>
              <label className="block text-sm font-medium mb-2">åšé¢˜æ¨¡å¼</label>
              <div className="grid grid-cols-3 gap-2">
                {[
                  { value: 'sequential', label: 'é¡ºåº', icon: 'â¡ï¸' },
                  { value: 'random', label: 'éšæœº', icon: 'ğŸ”€' },
                  { value: 'adaptive', label: 'è‡ªé€‚åº”', icon: 'ğŸ§ ' }
                ].map(opt => (
                  <button
                    key={opt.value}
                    onClick={() => setConfig({ ...config, questionMode: opt.value as any })}
                    className={`p-3 rounded-xl text-center transition-all ${
                      config.questionMode === opt.value
                        ? 'bg-blue-600 ring-2 ring-blue-400'
                        : 'bg-slate-700 hover:bg-slate-600'
                    }`}
                  >
                    <span className="text-xl block mb-1">{opt.icon}</span>
                    <span className="text-sm">{opt.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* é¢„è§ˆ */}
            <div className="p-4 bg-slate-700/50 rounded-xl">
              <h4 className="font-medium mb-2">ğŸ“Š è¯¾ç¨‹é¢„è§ˆ</h4>
              <p className="text-sm text-slate-400">
                å°†ç”Ÿæˆ <span className="text-white font-bold">{config.mapCount}</span> å¼ åœ°å›¾ï¼Œ
                å…± <span className="text-white font-bold">{config.mapCount * config.levelsPerMap}</span> ä¸ªå…³å¡
              </p>
            </div>

            {/* æ“ä½œæŒ‰é’® */}
            <div className="flex gap-3">
              <button
                onClick={() => setStep('import')}
                className="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl"
              >
                ä¸Šä¸€æ­¥
              </button>
              <button
                onClick={handleGenerate}
                className="flex-1 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 rounded-xl font-bold"
              >
                ğŸš€ å¼€å§‹ç”Ÿæˆ
              </button>
            </div>
          </div>
        )}

        {/* Step 3: ç”Ÿæˆä¸­ */}
        {step === 'generate' && (
          <div className="p-6 text-center space-y-6">
            <div className="text-6xl animate-bounce">ğŸ¤–</div>
            <h3 className="text-xl font-bold">AI æ­£åœ¨ç”Ÿæˆè¯¾ç¨‹...</h3>
            <p className="text-slate-400">
              æ­£åœ¨ç”Ÿæˆç¬¬ {progress.current} / {progress.total} å¼ åœ°å›¾
            </p>
            <div className="w-full h-3 bg-slate-700 rounded-full overflow-hidden">
              <div
                className="h-full bg-gradient-to-r from-purple-600 to-blue-600 transition-all duration-500"
                style={{ width: `${(progress.current / Math.max(progress.total, 1)) * 100}%` }}
              />
            </div>
            <p className="text-sm text-slate-500">
              é¢„è®¡éœ€è¦ {progress.total * 3} ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…
            </p>
          </div>
        )}

        {/* Step 4: å®Œæˆ */}
        {step === 'complete' && (
          <div className="p-6 text-center space-y-6">
            <div className="text-6xl">ğŸ‰</div>
            <h3 className="text-xl font-bold">è¯¾ç¨‹åˆ›å»ºæˆåŠŸï¼</h3>
            <p className="text-slate-400">
              "{courseName}" å·²æ·»åŠ åˆ°ä½ çš„è¯¾ç¨‹åˆ—è¡¨
            </p>
            <button
              onClick={onCancel}
              className="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold"
            >
              å¼€å§‹å­¦ä¹ 
            </button>
          </div>
        )}

      </div>
    </div>
  );
};

export default CourseCreator;
```

### ğŸ“¤ Output
- `src/components/course/CourseCreator.tsx`

---

## Step A.4: åŠ¨æ€è¯¾ç¨‹ç®¡ç†

### ğŸ“ Spec

åœ¨ `App.tsx` æˆ– `LevelMap.tsx` ä¸­é›†æˆè‡ªå®šä¹‰è¯¾ç¨‹ï¼š

```typescript
// è·å–æ‰€æœ‰è¯¾ç¨‹ï¼ˆå†…ç½® + è‡ªå®šä¹‰ï¼‰
const getAllCourses = (): Course[] => {
  const builtinCourses = [PYTHON_COURSE, ZEABUR_COURSE];
  const customCourses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
  return [...builtinCourses, ...customCourses];
};

// åˆ é™¤è‡ªå®šä¹‰è¯¾ç¨‹
const deleteCustomCourse = (courseId: string) => {
  const courses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
  const filtered = courses.filter((c: Course) => c.id !== courseId);
  localStorage.setItem('zlearn_custom_courses', JSON.stringify(filtered));
};
```

---

# PHASE C: æ¸¸æˆåŒ–é…ç½®ç³»ç»Ÿ

> **è®¾è®¡åŸåˆ™**: åƒæ¸¸æˆå¼€å‘ä¸€æ ·ï¼Œæ‰€æœ‰å…³å¡å‚æ•°éƒ½é€šè¿‡é…ç½®æ–‡ä»¶æš´éœ²ï¼Œå®ç°"æ•°æ®é©±åŠ¨"çš„å…³å¡è®¾è®¡ã€‚

## C.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONFIGURATION SYSTEM ARCHITECTURE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   é…ç½®æ–‡ä»¶å±‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“ /config/                                                 â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€ game.config.json        # å…¨å±€æ¸¸æˆæœºåˆ¶                   â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€ courses/                # è¯¾ç¨‹é…ç½®ç›®å½•                   â”‚  â”‚
â”‚   â”‚  â”‚   â”œâ”€â”€ python.course.json  # Python è¯¾ç¨‹å®šä¹‰               â”‚  â”‚
â”‚   â”‚  â”‚   â”œâ”€â”€ zeabur.course.json  # Zeabur è¯¾ç¨‹å®šä¹‰               â”‚  â”‚
â”‚   â”‚  â”‚   â””â”€â”€ custom/             # ç”¨æˆ·è‡ªå®šä¹‰è¯¾ç¨‹                 â”‚  â”‚
â”‚   â”‚  â”œâ”€â”€ ai.config.json          # AI æœåŠ¡é…ç½®                   â”‚  â”‚
â”‚   â”‚  â””â”€â”€ audio.config.json       # éŸ³æ•ˆé…ç½®                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ”§ ConfigService                                            â”‚  â”‚
â”‚   â”‚  â€¢ loadConfig(): åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶                             â”‚  â”‚
â”‚   â”‚  â€¢ get(path): è·å–é…ç½®é¡¹ (æ”¯æŒç‚¹å·è·¯å¾„)                       â”‚  â”‚
â”‚   â”‚  â€¢ override(path, value): è¿è¡Œæ—¶è¦†ç›–                          â”‚  â”‚
â”‚   â”‚  â€¢ reset(): é‡ç½®ä¸ºé»˜è®¤å€¼                                      â”‚  â”‚
â”‚   â”‚  â€¢ watch(path, callback): ç›‘å¬é…ç½®å˜åŒ–                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ® æ¸¸æˆè¿è¡Œæ—¶                                               â”‚  â”‚
â”‚   â”‚  â€¢ å…³å¡éš¾åº¦å‚æ•°åŠ¨æ€è¯»å–                                       â”‚  â”‚
â”‚   â”‚  â€¢ è¯„åˆ†è§„åˆ™å¯é…ç½®                                             â”‚  â”‚
â”‚   â”‚  â€¢ AI è¡Œä¸ºå¯è°ƒæ•´                                              â”‚  â”‚
â”‚   â”‚  â€¢ ç”¨æˆ·å¯é€šè¿‡ localStorage è¦†ç›–                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step C.1: è¯¾ç¨‹/å…³å¡é…ç½®æ–‡ä»¶è®¾è®¡

### ğŸ“ Spec

#### å…¨å±€æ¸¸æˆé…ç½® (game.config.json)

```json
{
  "$schema": "./schemas/game.schema.json",
  "version": "2.0.0",
  
  "scoring": {
    "baseScore": 1000,
    "timeBonusMultiplier": 20,
    "starRules": {
      "firstAttempt": 3,
      "secondAttempt": 2,
      "thirdOrMore": 1
    },
    "xpRewards": {
      "level1Star": 500,
      "level2Star": 750,
      "level3Star": 1000,
      "mapComplete": 500,
      "courseComplete": 2000
    }
  },
  
  "difficulty": {
    "easy": {
      "timeLimit": 0,
      "hintsAllowed": 3,
      "penaltyPerWrong": 0,
      "showExplanation": true
    },
    "medium": {
      "timeLimit": 60,
      "hintsAllowed": 2,
      "penaltyPerWrong": 100,
      "showExplanation": true
    },
    "hard": {
      "timeLimit": 45,
      "hintsAllowed": 1,
      "penaltyPerWrong": 200,
      "showExplanation": false
    }
  },
  
  "progression": {
    "unlockMode": "sequential",
    "requireStarsToUnlock": 0,
    "allowReplay": true,
    "autoAdvance": true,
    "autoAdvanceDelay": 1500
  },
  
  "coach": {
    "defaultPersona": "professional",
    "defaultVoice": "zh-CN-XiaoxiaoNeural",
    "autoReadQuestion": true,
    "showHintAfterWrong": 2
  },
  
  "review": {
    "showAfterLevel": true,
    "showAfterMap": true,
    "aiSummaryEnabled": true
  }
}
```

#### è¯¾ç¨‹é…ç½® (zeabur.course.json) - å®Œæ•´ç¤ºä¾‹

```json
{
  "$schema": "../schemas/course.schema.json",
  "id": "zeabur",
  "version": "1.0.0",
  
  "metadata": {
    "name": "Zeabur äº‘å¹³å°é€Ÿæˆ",
    "icon": "â˜ï¸",
    "description": "å¿«é€ŸæŒæ¡ Zeabur éƒ¨ç½²å¹³å°æ ¸å¿ƒæ¦‚å¿µ",
    "author": "Lalalearn Team",
    "tags": ["äº‘è®¡ç®—", "éƒ¨ç½²", "DevOps"],
    "difficulty": "beginner",
    "estimatedTime": "30åˆ†é’Ÿ",
    "targetAudience": ["å¸‚åœºäººå‘˜", "é”€å”®äººå‘˜", "æ–°å‘˜å·¥"]
  },
  
  "settings": {
    "type": "concept",
    "questionModes": ["single_choice", "true_false", "fill_blank"],
    "difficultyProgression": "progressive",
    "shuffleQuestions": false,
    "allowSkip": false
  },
  
  "maps": [
    {
      "id": 0,
      "title": "ğŸš€ å¹³å°å…¥é—¨",
      "description": "äº†è§£ Zeabur æ˜¯ä»€ä¹ˆ",
      "unlockCondition": null,
      "bonusXP": 500
    },
    {
      "id": 1,
      "title": "âš¡ æ ¸å¿ƒåŠŸèƒ½",
      "description": "æŒæ¡ä¸€é”®éƒ¨ç½²ç­‰æ ¸å¿ƒèƒ½åŠ›",
      "unlockCondition": { "mapId": 0, "minStars": 5 },
      "bonusXP": 600
    }
  ],
  
  "levels": [
    {
      "id": 1,
      "mapIndex": 0,
      "title": "ä»€ä¹ˆæ˜¯ Zeaburï¼Ÿ",
      "description": "è®¤è¯† Zeabur å¹³å°å®šä½",
      "difficulty": "easy",
      
      "config": {
        "timeLimit": 0,
        "maxAttempts": 0,
        "showHints": true,
        "hintCost": 0,
        "xpBase": 100,
        "xpBonus": {
          "noHint": 20,
          "fastComplete": 30,
          "firstTry": 50
        }
      },
      
      "question": {
        "type": "single_choice",
        "question": "Zeabur æ˜¯ä¸€ä¸ªä»€ä¹ˆç±»å‹çš„å¹³å°ï¼Ÿ",
        "options": [
          { "key": "A", "text": "ç¤¾äº¤åª’ä½“å¹³å°" },
          { "key": "B", "text": "äº‘ç«¯åº”ç”¨éƒ¨ç½²å¹³å°" },
          { "key": "C", "text": "åœ¨çº¿æ–‡æ¡£ç¼–è¾‘å™¨" },
          { "key": "D", "text": "ç”µå•†è´­ç‰©å¹³å°" }
        ],
        "correctAnswer": "B",
        "explanation": "Zeabur æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„äº‘ç«¯åº”ç”¨éƒ¨ç½²å¹³å°ï¼Œè®©å¼€å‘è€…å¯ä»¥è½»æ¾éƒ¨ç½²å„ç§åº”ç”¨ã€‚",
        "hints": [
          "æƒ³æƒ³ Zeabur ä¸»è¦å¸®åŠ©å¼€å‘è€…åšä»€ä¹ˆ",
          "å®ƒè·ŸæœåŠ¡å™¨éƒ¨ç½²æœ‰å…³"
        ]
      },
      
      "coaching": {
        "introMessage": "è®©æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹ Zeabur æ˜¯ä»€ä¹ˆå§ï¼",
        "successMessage": "æ²¡é”™ï¼Zeabur å°±æ˜¯å¸®ä½ ä¸€é”®éƒ¨ç½²åº”ç”¨çš„å¹³å°ï¼",
        "failMessage": "å†æƒ³æƒ³ï¼ŒZeabur æ˜¯å¸®åŠ©å¼€å‘è€…éƒ¨ç½²åº”ç”¨çš„...",
        "contextTags": ["platform", "introduction"]
      }
    },
    {
      "id": 2,
      "mapIndex": 0,
      "title": "æ ¸å¿ƒä¼˜åŠ¿",
      "description": "äº†è§£ Zeabur çš„å…³é”®ç‰¹ç‚¹",
      "difficulty": "easy",
      
      "config": {
        "timeLimit": 0,
        "maxAttempts": 0,
        "showHints": true
      },
      
      "question": {
        "type": "true_false",
        "statement": "Zeabur éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é…ç½® CI/CD æµæ°´çº¿æ‰èƒ½éƒ¨ç½²åº”ç”¨ã€‚",
        "correctAnswer": false,
        "explanation": "Zeabur æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¼€ç®±å³ç”¨çš„ CI/CDï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å³å¯è‡ªåŠ¨æ„å»ºéƒ¨ç½²ã€‚"
      }
    }
  ]
}
```

#### å…³å¡é…ç½®ç±»å‹å®šä¹‰

```typescript
// ============================================================
// æ–‡ä»¶: src/types/config.ts
// ============================================================

/** å…³å¡é…ç½® */
export interface LevelConfig {
  timeLimit: number;           // æ—¶é—´é™åˆ¶ (ç§’), 0=æ— é™åˆ¶
  maxAttempts: number;         // æœ€å¤§å°è¯•æ¬¡æ•°, 0=æ— é™åˆ¶
  showHints: boolean;          // æ˜¯å¦æ˜¾ç¤ºæç¤º
  hintCost: number;            // æ¯æ¬¡æç¤ºæ‰£åˆ†
  xpBase: number;              // åŸºç¡€ç»éªŒå€¼
  xpBonus: {
    noHint: number;            // ä¸ç”¨æç¤ºå¥–åŠ±
    fastComplete: number;      // å¿«é€Ÿå®Œæˆå¥–åŠ±
    firstTry: number;          // ä¸€æ¬¡é€šè¿‡å¥–åŠ±
  };
}

/** æ•™ç»ƒé…ç½® */
export interface CoachingConfig {
  introMessage?: string;       // å…³å¡å¼€å§‹æ¶ˆæ¯
  successMessage?: string;     // æˆåŠŸæ¶ˆæ¯
  failMessage?: string;        // å¤±è´¥æ¶ˆæ¯
  contextTags?: string[];      // ä¸Šä¸‹æ–‡æ ‡ç­¾
}

/** å®Œæ•´å…³å¡å®šä¹‰ */
export interface LevelDefinition {
  id: number;
  mapIndex: number;
  title: string;
  description: string;
  difficulty: 'easy' | 'medium' | 'hard';
  config: LevelConfig;
  question: QuestionDefinition;
  coaching?: CoachingConfig;
}

/** è¯¾ç¨‹å…ƒæ•°æ® */
export interface CourseMetadata {
  name: string;
  icon: string;
  description: string;
  author: string;
  tags: string[];
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  estimatedTime: string;
  targetAudience: string[];
}

/** å®Œæ•´è¯¾ç¨‹é…ç½® */
export interface CourseConfig {
  id: string;
  version: string;
  metadata: CourseMetadata;
  settings: CourseSettings;
  maps: MapDefinition[];
  levels: LevelDefinition[];
}
```

### ğŸ“¤ Output
- `src/types/config.ts`
- `config/game.config.json`
- `config/courses/zeabur.course.json`

---

## Step C.2: é…ç½®æœåŠ¡ (configService)

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/configService.ts
// ============================================================

import type { CourseConfig, LevelConfig } from '../types/config';

// é™æ€å¯¼å…¥é»˜è®¤é…ç½®
import defaultGameConfig from '../config/game.config.json';
import zeaburCourse from '../config/courses/zeabur.course.json';
import pythonCourse from '../config/courses/python.course.json';

export interface GameConfig {
  scoring: {
    baseScore: number;
    timeBonusMultiplier: number;
    starRules: { firstAttempt: number; secondAttempt: number; thirdOrMore: number };
    xpRewards: Record<string, number>;
  };
  difficulty: Record<string, {
    timeLimit: number;
    hintsAllowed: number;
    penaltyPerWrong: number;
    showExplanation: boolean;
  }>;
  progression: {
    unlockMode: 'sequential' | 'free' | 'stars';
    requireStarsToUnlock: number;
    allowReplay: boolean;
    autoAdvance: boolean;
    autoAdvanceDelay: number;
  };
  coach: {
    defaultPersona: string;
    defaultVoice: string;
    autoReadQuestion: boolean;
    showHintAfterWrong: number;
  };
  review: {
    showAfterLevel: boolean;
    showAfterMap: boolean;
    aiSummaryEnabled: boolean;
  };
}

class ConfigService {
  private gameConfig: GameConfig;
  private courses: Map<string, CourseConfig> = new Map();
  private overrides: Record<string, any> = {};
  private listeners: Map<string, Set<(value: any) => void>> = new Map();

  constructor() {
    // åŠ è½½é»˜è®¤é…ç½®
    this.gameConfig = defaultGameConfig as GameConfig;
    
    // åŠ è½½å†…ç½®è¯¾ç¨‹
    this.courses.set('zeabur', zeaburCourse as CourseConfig);
    this.courses.set('python', pythonCourse as CourseConfig);
    
    // ä» localStorage æ¢å¤ç”¨æˆ·è¦†ç›–
    this.loadOverrides();
  }

  // === æ¸¸æˆé…ç½®è®¿é—® ===
  
  /**
   * è·å–é…ç½®å€¼ (æ”¯æŒç‚¹å·è·¯å¾„)
   * @example config.get('scoring.baseScore') => 1000
   */
  get<T = any>(path: string): T {
    // å…ˆæ£€æŸ¥è¦†ç›–å€¼
    if (path in this.overrides) {
      return this.overrides[path] as T;
    }
    
    // ä»é…ç½®ä¸­è¯»å–
    const keys = path.split('.');
    let value: any = this.gameConfig;
    
    for (const key of keys) {
      if (value && typeof value === 'object' && key in value) {
        value = value[key];
      } else {
        return undefined as T;
      }
    }
    
    return value as T;
  }

  /**
   * è¿è¡Œæ—¶è¦†ç›–é…ç½® (ä¿å­˜åˆ° localStorage)
   */
  override(path: string, value: any): void {
    this.overrides[path] = value;
    this.saveOverrides();
    this.notifyListeners(path, value);
  }

  /**
   * é‡ç½®æŒ‡å®šé…ç½®é¡¹
   */
  reset(path?: string): void {
    if (path) {
      delete this.overrides[path];
    } else {
      this.overrides = {};
    }
    this.saveOverrides();
  }

  /**
   * ç›‘å¬é…ç½®å˜åŒ–
   */
  watch(path: string, callback: (value: any) => void): () => void {
    if (!this.listeners.has(path)) {
      this.listeners.set(path, new Set());
    }
    this.listeners.get(path)!.add(callback);
    
    // è¿”å›å–æ¶ˆç›‘å¬å‡½æ•°
    return () => {
      this.listeners.get(path)?.delete(callback);
    };
  }

  // === è¯¾ç¨‹é…ç½®è®¿é—® ===

  /**
   * è·å–è¯¾ç¨‹é…ç½®
   */
  getCourse(courseId: string): CourseConfig | undefined {
    return this.courses.get(courseId);
  }

  /**
   * è·å–æ‰€æœ‰è¯¾ç¨‹
   */
  getAllCourses(): CourseConfig[] {
    return Array.from(this.courses.values());
  }

  /**
   * æ³¨å†Œè‡ªå®šä¹‰è¯¾ç¨‹
   */
  registerCourse(course: CourseConfig): void {
    this.courses.set(course.id, course);
  }

  /**
   * è·å–å…³å¡é…ç½® (åˆå¹¶å…¨å±€é»˜è®¤å€¼)
   */
  getLevelConfig(courseId: string, levelId: number): LevelConfig {
    const course = this.courses.get(courseId);
    const level = course?.levels.find(l => l.id === levelId);
    const difficulty = level?.difficulty || 'easy';
    
    // åˆå¹¶: å…¨å±€é»˜è®¤ -> éš¾åº¦é»˜è®¤ -> å…³å¡è‡ªå®šä¹‰
    const globalDefaults = this.get<GameConfig['difficulty'][string]>(`difficulty.${difficulty}`);
    const levelConfig = level?.config || {};
    
    return {
      timeLimit: levelConfig.timeLimit ?? globalDefaults?.timeLimit ?? 0,
      maxAttempts: levelConfig.maxAttempts ?? 0,
      showHints: levelConfig.showHints ?? true,
      hintCost: levelConfig.hintCost ?? 0,
      xpBase: levelConfig.xpBase ?? 100,
      xpBonus: levelConfig.xpBonus ?? { noHint: 20, fastComplete: 30, firstTry: 50 }
    };
  }

  // === ç§æœ‰æ–¹æ³• ===

  private loadOverrides(): void {
    try {
      const saved = localStorage.getItem('lalalearn_config_overrides');
      if (saved) {
        this.overrides = JSON.parse(saved);
      }
    } catch (e) {
      console.warn('Failed to load config overrides:', e);
    }
  }

  private saveOverrides(): void {
    localStorage.setItem('lalalearn_config_overrides', JSON.stringify(this.overrides));
  }

  private notifyListeners(path: string, value: any): void {
    this.listeners.get(path)?.forEach(cb => cb(value));
  }
}

export const configService = new ConfigService();

// React Hook
export function useConfig<T = any>(path: string): T {
  const [value, setValue] = React.useState<T>(() => configService.get<T>(path));
  
  React.useEffect(() => {
    return configService.watch(path, setValue);
  }, [path]);
  
  return value;
}
```

### ğŸ“¤ Output
- `src/services/configService.ts`

---

## Step C.3: é…ç½®çƒ­åŠ è½½ä¸è¿è¡Œæ—¶è¦†ç›–

### ğŸ“ Spec

åœ¨ `App.tsx` ä¸­é›†æˆé…ç½®æœåŠ¡ï¼š

```typescript
// åœ¨ App.tsx ä¸­ä½¿ç”¨é…ç½®
import { configService, useConfig } from './services/configService';

function App() {
  // ä½¿ç”¨ Hook è¯»å–é…ç½®
  const autoAdvance = useConfig<boolean>('progression.autoAdvance');
  const autoAdvanceDelay = useConfig<number>('progression.autoAdvanceDelay');
  
  // æˆ–ç›´æ¥è°ƒç”¨
  const starRules = configService.get('scoring.starRules');
  
  // æ ¹æ®é…ç½®è®¡ç®—æ˜Ÿæ˜Ÿ
  const calculateStars = (attempts: number): number => {
    if (attempts === 1) return starRules.firstAttempt;
    if (attempts === 2) return starRules.secondAttempt;
    return starRules.thirdOrMore;
  };
  
  // è·å–å…³å¡é…ç½®
  const levelConfig = configService.getLevelConfig('zeabur', currentLevel);
  
  // ...
}
```

### é…ç½®è¿ç§»: å°†ç°æœ‰ç¡¬ç¼–ç æ”¹ä¸ºé…ç½®

```typescript
// ä¹‹å‰ (ç¡¬ç¼–ç )
const getStars = (attempts: number) => {
  if (attempts <= 1) return 3;
  if (attempts === 2) return 2;
  return 1;
};

// ä¹‹å (é…ç½®é©±åŠ¨)
const getStars = (attempts: number) => {
  const rules = configService.get('scoring.starRules');
  if (attempts <= 1) return rules.firstAttempt;
  if (attempts === 2) return rules.secondAttempt;
  return rules.thirdOrMore;
};
```

---

## Step C.4: é…ç½®ç¼–è¾‘å™¨ UI (å¯é€‰)

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/components/settings/ConfigEditor.tsx
// ============================================================

import React, { useState } from 'react';
import { configService, GameConfig } from '../../services/configService';

interface ConfigEditorProps {
  onClose: () => void;
}

const ConfigEditor: React.FC<ConfigEditorProps> = ({ onClose }) => {
  // å¯ç¼–è¾‘çš„é…ç½®é¡¹
  const [starRules, setStarRules] = useState({
    firstAttempt: configService.get<number>('scoring.starRules.firstAttempt'),
    secondAttempt: configService.get<number>('scoring.starRules.secondAttempt'),
    thirdOrMore: configService.get<number>('scoring.starRules.thirdOrMore')
  });
  
  const [autoAdvance, setAutoAdvance] = useState(
    configService.get<boolean>('progression.autoAdvance')
  );
  
  const [autoReadQuestion, setAutoReadQuestion] = useState(
    configService.get<boolean>('coach.autoReadQuestion')
  );

  const handleSave = () => {
    configService.override('scoring.starRules.firstAttempt', starRules.firstAttempt);
    configService.override('scoring.starRules.secondAttempt', starRules.secondAttempt);
    configService.override('scoring.starRules.thirdOrMore', starRules.thirdOrMore);
    configService.override('progression.autoAdvance', autoAdvance);
    configService.override('coach.autoReadQuestion', autoReadQuestion);
    onClose();
  };

  const handleReset = () => {
    configService.reset();
    window.location.reload();
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
      <div className="bg-slate-800 rounded-2xl w-full max-w-lg">
        <div className="p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold">âš™ï¸ æ¸¸æˆé…ç½®</h2>
          <p className="text-sm text-slate-400 mt-1">è°ƒæ•´æ¸¸æˆå‚æ•° (ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ)</p>
        </div>

        <div className="p-6 space-y-6">
          {/* æ˜Ÿæ˜Ÿè§„åˆ™ */}
          <div>
            <h3 className="font-medium mb-3">â­ æ˜Ÿæ˜Ÿè¯„åˆ†è§„åˆ™</h3>
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="text-sm text-slate-400">é¦–æ¬¡é€šè¿‡</label>
                <input
                  type="number"
                  min={1}
                  max={3}
                  value={starRules.firstAttempt}
                  onChange={(e) => setStarRules({ ...starRules, firstAttempt: Number(e.target.value) })}
                  className="w-full mt-1 p-2 bg-slate-700 rounded-lg"
                />
              </div>
              <div>
                <label className="text-sm text-slate-400">ç¬¬äºŒæ¬¡é€šè¿‡</label>
                <input
                  type="number"
                  min={1}
                  max={3}
                  value={starRules.secondAttempt}
                  onChange={(e) => setStarRules({ ...starRules, secondAttempt: Number(e.target.value) })}
                  className="w-full mt-1 p-2 bg-slate-700 rounded-lg"
                />
              </div>
              <div>
                <label className="text-sm text-slate-400">ä¸‰æ¬¡åŠä»¥ä¸Š</label>
                <input
                  type="number"
                  min={1}
                  max={3}
                  value={starRules.thirdOrMore}
                  onChange={(e) => setStarRules({ ...starRules, thirdOrMore: Number(e.target.value) })}
                  className="w-full mt-1 p-2 bg-slate-700 rounded-lg"
                />
              </div>
            </div>
          </div>

          {/* è‡ªåŠ¨åŠŸèƒ½ */}
          <div className="space-y-3">
            <h3 className="font-medium">ğŸ”„ è‡ªåŠ¨åŠŸèƒ½</h3>
            <label className="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                checked={autoAdvance}
                onChange={(e) => setAutoAdvance(e.target.checked)}
                className="w-5 h-5 rounded"
              />
              <span>ç­”å¯¹åè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å…³</span>
            </label>
            <label className="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                checked={autoReadQuestion}
                onChange={(e) => setAutoReadQuestion(e.target.checked)}
                className="w-5 h-5 rounded"
              />
              <span>è‡ªåŠ¨æœ—è¯»é¢˜ç›®</span>
            </label>
          </div>
        </div>

        <div className="p-6 border-t border-slate-700 flex gap-3">
          <button
            onClick={handleReset}
            className="px-4 py-2 bg-red-600/20 text-red-400 hover:bg-red-600/30 rounded-lg"
          >
            é‡ç½®é»˜è®¤
          </button>
          <div className="flex-1" />
          <button
            onClick={onClose}
            className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg"
          >
            å–æ¶ˆ
          </button>
          <button
            onClick={handleSave}
            className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>
  );
};

export default ConfigEditor;
```

### ğŸ“¤ Output
- `src/components/settings/ConfigEditor.tsx`

---

## C.5 è¯¾ç¨‹é…ç½®ä¸ constants.ts è¿ç§»

### è¿ç§»è®¡åˆ’

å°†ç°æœ‰ `constants.ts` ä¸­çš„è¯¾ç¨‹æ•°æ®è¿ç§»åˆ° JSON é…ç½®æ–‡ä»¶ï¼š

```typescript
// ä¹‹å‰ (constants.ts)
export const ZEABUR_COURSE = {
  id: 'zeabur',
  name: 'Zeabur äº‘å¹³å°é€Ÿæˆ',
  // ...100 ä¸ªå…³å¡ç¡¬ç¼–ç 
};

// ä¹‹å (config/courses/zeabur.course.json)
// å…¨éƒ¨å…³å¡æ•°æ®ç§»åˆ° JSON æ–‡ä»¶
// constants.ts åªä¿ç•™çº¯é™æ€å¸¸é‡ (å¦‚éŸ³æ•ˆ URL)
```

### è¿ç§»æ­¥éª¤

1. åˆ›å»º `config/courses/` ç›®å½•
2. å°† `ZEABUR_COURSE` å¯¼å‡ºä¸º `zeabur.course.json`
3. å°† `PYTHON_LEVELS` å¯¼å‡ºä¸º `python.course.json`
4. æ›´æ–° `configService` åŠ è½½è¿™äº›æ–‡ä»¶
5. ä¿®æ”¹ `App.tsx` å’Œ `LevelMap.tsx` ä½¿ç”¨ `configService.getCourse()`

---

# PHASE B: æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ

## B.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA ANALYTICS ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ç”¨æˆ·è¡Œä¸º                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“Š åŸ‹ç‚¹äº‹ä»¶                                                  â”‚  â”‚
â”‚   â”‚  â€¢ é¡µé¢è®¿é—®  â€¢ ç­”é¢˜è¡Œä¸º  â€¢ å­¦ä¹ æ—¶é•¿  â€¢ é”™è¯¯ç‡                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ’¾ IndexedDB å­˜å‚¨                                           â”‚  â”‚
â”‚   â”‚  â€¢ events: åŸ‹ç‚¹äº‹ä»¶                                          â”‚  â”‚
â”‚   â”‚  â€¢ users: ç”¨æˆ·æ•°æ®                                           â”‚  â”‚
â”‚   â”‚  â€¢ progress: å­¦ä¹ è¿›åº¦                                        â”‚  â”‚
â”‚   â”‚  â€¢ analytics: åˆ†ææ±‡æ€»                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“ˆ åˆ†æå¼•æ“                                                  â”‚  â”‚
â”‚   â”‚  â€¢ ç•™å­˜åˆ†æ (D1/D7/D30)                                      â”‚  â”‚
â”‚   â”‚  â€¢ å­¦ä¹ ä¹ æƒ¯ (æ—¶æ®µ/æ—¶é•¿/é¢‘ç‡)                                  â”‚  â”‚
â”‚   â”‚  â€¢ å¡ç‚¹åˆ†æ (é”™é¢˜/æ”¾å¼ƒ)                                       â”‚  â”‚
â”‚   â”‚  â€¢ è¡Œä¸ºæ¼æ–—                                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â˜ï¸ Zeabur å¤‡ä»½ (æ‰‹åŠ¨å¯¼å‡º/å®šæ—¶)                               â”‚  â”‚
â”‚   â”‚  â€¢ JSON å¯¼å‡ºä¸‹è½½                                             â”‚  â”‚
â”‚   â”‚  â€¢ å¯é€‰: ä¸Šä¼ åˆ° Zeabur Object Storage                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step B.1: IndexedDB å­˜å‚¨æœåŠ¡

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/storageService.ts
// ============================================================

import { openDB, IDBPDatabase } from 'idb';

const DB_NAME = 'zlearn_db';
const DB_VERSION = 1;

export interface AnalyticsEvent {
  id: string;
  type: string;
  userId: string;
  sessionId: string;
  timestamp: number;
  data: Record<string, any>;
}

export interface UserProgress {
  id: string;
  courseId: string;
  levelId: number;
  stars: number;
  attempts: number;
  timeSpent: number;
  completedAt: number;
}

export interface LearningSession {
  id: string;
  userId: string;
  startTime: number;
  endTime?: number;
  duration: number;
  levelsCompleted: number;
  correctAnswers: number;
  wrongAnswers: number;
}

class StorageService {
  private db: IDBPDatabase | null = null;

  async init(): Promise<void> {
    this.db = await openDB(DB_NAME, DB_VERSION, {
      upgrade(db) {
        // åŸ‹ç‚¹äº‹ä»¶è¡¨
        if (!db.objectStoreNames.contains('events')) {
          const eventStore = db.createObjectStore('events', { keyPath: 'id' });
          eventStore.createIndex('type', 'type');
          eventStore.createIndex('userId', 'userId');
          eventStore.createIndex('timestamp', 'timestamp');
        }

        // å­¦ä¹ è¿›åº¦è¡¨
        if (!db.objectStoreNames.contains('progress')) {
          const progressStore = db.createObjectStore('progress', { keyPath: 'id' });
          progressStore.createIndex('courseId', 'courseId');
          progressStore.createIndex('userId', 'userId');
        }

        // å­¦ä¹ ä¼šè¯è¡¨
        if (!db.objectStoreNames.contains('sessions')) {
          const sessionStore = db.createObjectStore('sessions', { keyPath: 'id' });
          sessionStore.createIndex('userId', 'userId');
          sessionStore.createIndex('startTime', 'startTime');
        }

        // è‡ªå®šä¹‰è¯¾ç¨‹è¡¨
        if (!db.objectStoreNames.contains('courses')) {
          db.createObjectStore('courses', { keyPath: 'id' });
        }
      }
    });
  }

  // === åŸ‹ç‚¹äº‹ä»¶ ===
  async addEvent(event: Omit<AnalyticsEvent, 'id'>): Promise<string> {
    const id = `evt_${Date.now()}_${Math.random().toString(36).slice(2)}`;
    await this.db?.put('events', { ...event, id });
    return id;
  }

  async getEvents(
    filter?: { type?: string; userId?: string; startTime?: number; endTime?: number }
  ): Promise<AnalyticsEvent[]> {
    let events = await this.db?.getAll('events') || [];
    
    if (filter?.type) {
      events = events.filter(e => e.type === filter.type);
    }
    if (filter?.userId) {
      events = events.filter(e => e.userId === filter.userId);
    }
    if (filter?.startTime) {
      events = events.filter(e => e.timestamp >= filter.startTime!);
    }
    if (filter?.endTime) {
      events = events.filter(e => e.timestamp <= filter.endTime!);
    }
    
    return events;
  }

  // === å­¦ä¹ è¿›åº¦ ===
  async saveProgress(progress: UserProgress): Promise<void> {
    await this.db?.put('progress', progress);
  }

  async getProgress(userId: string, courseId?: string): Promise<UserProgress[]> {
    let progress = await this.db?.getAll('progress') || [];
    progress = progress.filter(p => p.userId === userId);
    if (courseId) {
      progress = progress.filter(p => p.courseId === courseId);
    }
    return progress;
  }

  // === å­¦ä¹ ä¼šè¯ ===
  async startSession(userId: string): Promise<string> {
    const id = `sess_${Date.now()}`;
    await this.db?.put('sessions', {
      id,
      userId,
      startTime: Date.now(),
      duration: 0,
      levelsCompleted: 0,
      correctAnswers: 0,
      wrongAnswers: 0
    });
    return id;
  }

  async endSession(sessionId: string): Promise<void> {
    const session = await this.db?.get('sessions', sessionId);
    if (session) {
      session.endTime = Date.now();
      session.duration = session.endTime - session.startTime;
      await this.db?.put('sessions', session);
    }
  }

  // === æ•°æ®å¯¼å‡º (å¤‡ä»½) ===
  async exportAllData(): Promise<string> {
    const data = {
      exportedAt: new Date().toISOString(),
      events: await this.db?.getAll('events'),
      progress: await this.db?.getAll('progress'),
      sessions: await this.db?.getAll('sessions'),
      courses: await this.db?.getAll('courses')
    };
    return JSON.stringify(data, null, 2);
  }

  // === æ•°æ®å¯¼å…¥ (æ¢å¤) ===
  async importData(jsonString: string): Promise<void> {
    const data = JSON.parse(jsonString);
    
    if (data.events) {
      for (const event of data.events) {
        await this.db?.put('events', event);
      }
    }
    if (data.progress) {
      for (const prog of data.progress) {
        await this.db?.put('progress', prog);
      }
    }
    if (data.sessions) {
      for (const session of data.sessions) {
        await this.db?.put('sessions', session);
      }
    }
    if (data.courses) {
      for (const course of data.courses) {
        await this.db?.put('courses', course);
      }
    }
  }

  // === æ¸…ç†æ—§æ•°æ® ===
  async cleanOldEvents(daysToKeep: number = 30): Promise<number> {
    const cutoff = Date.now() - daysToKeep * 24 * 60 * 60 * 1000;
    const events = await this.getEvents({ endTime: cutoff });
    
    for (const event of events) {
      await this.db?.delete('events', event.id);
    }
    
    return events.length;
  }
}

export const storageService = new StorageService();
```

### ğŸ“¤ Output
- `src/services/storageService.ts`

---

## Step B.2: åŸ‹ç‚¹äº‹ä»¶æ”¶é›†

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/analyticsService.ts
// ============================================================

import { storageService, AnalyticsEvent } from './storageService';
import { v4 as uuid } from 'uuid';

// é¢„å®šä¹‰äº‹ä»¶ç±»å‹
export const EVENTS = {
  // é¡µé¢äº‹ä»¶
  PAGE_VIEW: 'page_view',
  SESSION_START: 'session_start',
  SESSION_END: 'session_end',

  // è¯¾ç¨‹äº‹ä»¶
  COURSE_SELECT: 'course_select',
  COURSE_CREATE: 'course_create',

  // å­¦ä¹ äº‹ä»¶
  LEVEL_START: 'level_start',
  LEVEL_COMPLETE: 'level_complete',
  LEVEL_FAIL: 'level_fail',
  LEVEL_ABANDON: 'level_abandon',

  // ç­”é¢˜äº‹ä»¶
  ANSWER_SUBMIT: 'answer_submit',
  ANSWER_CORRECT: 'answer_correct',
  ANSWER_WRONG: 'answer_wrong',
  HINT_REQUEST: 'hint_request',

  // æ•™ç»ƒäº‹ä»¶
  COACH_CHAT: 'coach_chat',
  COACH_TTS: 'coach_tts',

  // å¤ç›˜äº‹ä»¶
  REVIEW_OPEN: 'review_open',
  REVIEW_AI_SUMMARY: 'review_ai_summary'
} as const;

class AnalyticsService {
  private userId: string = '';
  private sessionId: string = '';
  private eventQueue: Omit<AnalyticsEvent, 'id'>[] = [];
  private flushTimer: number | null = null;

  init(userId: string) {
    this.userId = userId;
    this.sessionId = uuid();
    this.track(EVENTS.SESSION_START, {});
    
    // æ¯ 10 ç§’æ‰¹é‡å†™å…¥
    this.flushTimer = window.setInterval(() => this.flush(), 10000);
    
    // é¡µé¢å…³é—­å‰å†™å…¥
    window.addEventListener('beforeunload', () => {
      this.track(EVENTS.SESSION_END, {});
      this.flush();
    });
  }

  track(type: string, data: Record<string, any>) {
    this.eventQueue.push({
      type,
      userId: this.userId,
      sessionId: this.sessionId,
      timestamp: Date.now(),
      data
    });

    // é‡è¦äº‹ä»¶ç«‹å³å†™å…¥
    if ([EVENTS.LEVEL_COMPLETE, EVENTS.SESSION_END].includes(type as any)) {
      this.flush();
    }
  }

  private async flush() {
    if (this.eventQueue.length === 0) return;
    
    const events = [...this.eventQueue];
    this.eventQueue = [];
    
    for (const event of events) {
      await storageService.addEvent(event);
    }
  }

  // === ä¾¿æ·æ–¹æ³• ===
  trackPageView(page: string) {
    this.track(EVENTS.PAGE_VIEW, { page });
  }

  trackLevelStart(courseId: string, levelId: number) {
    this.track(EVENTS.LEVEL_START, { courseId, levelId, startTime: Date.now() });
  }

  trackLevelComplete(courseId: string, levelId: number, stars: number, timeSpent: number) {
    this.track(EVENTS.LEVEL_COMPLETE, { courseId, levelId, stars, timeSpent });
  }

  trackAnswer(courseId: string, levelId: number, correct: boolean, attemptNumber: number) {
    this.track(correct ? EVENTS.ANSWER_CORRECT : EVENTS.ANSWER_WRONG, {
      courseId,
      levelId,
      attemptNumber
    });
  }

  destroy() {
    if (this.flushTimer) {
      clearInterval(this.flushTimer);
    }
    this.flush();
  }
}

export const analyticsService = new AnalyticsService();
```

### ğŸ“¤ Output
- `src/services/analyticsService.ts`

---

## Step B.3: ç•™å­˜/å­¦ä¹ åˆ†æå¼•æ“

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/analysisService.ts
// ============================================================

import { storageService, AnalyticsEvent } from './storageService';
import { EVENTS } from './analyticsService';

export interface RetentionData {
  d1: number;  // æ¬¡æ—¥ç•™å­˜ç‡ %
  d7: number;  // 7æ—¥ç•™å­˜ç‡ %
  d30: number; // 30æ—¥ç•™å­˜ç‡ %
}

export interface LearningHabits {
  preferredHours: number[];   // åå¥½å­¦ä¹ æ—¶æ®µ
  avgSessionDuration: number; // å¹³å‡å­¦ä¹ æ—¶é•¿ (åˆ†é’Ÿ)
  avgLevelsPerSession: number; // æ¯æ¬¡å­¦ä¹ å®Œæˆå…³å¡æ•°
  weeklyFrequency: number;    // å‘¨å­¦ä¹ é¢‘ç‡
}

export interface BottleneckAnalysis {
  levelId: number;
  courseId: string;
  failRate: number;      // å¤±è´¥ç‡ %
  avgAttempts: number;   // å¹³å‡å°è¯•æ¬¡æ•°
  abandonRate: number;   // æ”¾å¼ƒç‡ %
}

class AnalysisService {
  /**
   * è®¡ç®—ç•™å­˜ç‡
   */
  async calculateRetention(userId: string): Promise<RetentionData> {
    const now = Date.now();
    const day = 24 * 60 * 60 * 1000;
    
    const sessions = await storageService.getEvents({
      userId,
      type: EVENTS.SESSION_START
    });
    
    if (sessions.length === 0) {
      return { d1: 0, d7: 0, d30: 0 };
    }
    
    const firstSession = Math.min(...sessions.map(s => s.timestamp));
    const daysSinceFirst = Math.floor((now - firstSession) / day);
    
    // æ£€æŸ¥æŒ‡å®šå¤©æ•°åæ˜¯å¦æœ‰æ´»åŠ¨
    const hasActivityAfter = (days: number) => {
      const targetTime = firstSession + days * day;
      return sessions.some(s => s.timestamp >= targetTime && s.timestamp < targetTime + day);
    };
    
    return {
      d1: daysSinceFirst >= 1 && hasActivityAfter(1) ? 100 : 0,
      d7: daysSinceFirst >= 7 && hasActivityAfter(7) ? 100 : 0,
      d30: daysSinceFirst >= 30 && hasActivityAfter(30) ? 100 : 0
    };
  }

  /**
   * åˆ†æå­¦ä¹ ä¹ æƒ¯
   */
  async analyzeLearningHabits(userId: string): Promise<LearningHabits> {
    const events = await storageService.getEvents({ userId });
    
    // ç»Ÿè®¡å­¦ä¹ æ—¶æ®µ
    const hourCounts: number[] = new Array(24).fill(0);
    events.forEach(e => {
      const hour = new Date(e.timestamp).getHours();
      hourCounts[hour]++;
    });
    
    // æ‰¾å‡ºåå¥½æ—¶æ®µ (æ´»åŠ¨æœ€å¤šçš„ 3 ä¸ªå°æ—¶)
    const preferredHours = hourCounts
      .map((count, hour) => ({ hour, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 3)
      .map(h => h.hour);
    
    // è®¡ç®—å¹³å‡ä¼šè¯æ—¶é•¿
    const sessions = events.filter(e => e.type === EVENTS.SESSION_START);
    const sessionEnds = events.filter(e => e.type === EVENTS.SESSION_END);
    
    let totalDuration = 0;
    sessions.forEach(start => {
      const end = sessionEnds.find(e => 
        e.sessionId === start.sessionId && e.timestamp > start.timestamp
      );
      if (end) {
        totalDuration += end.timestamp - start.timestamp;
      }
    });
    
    const avgSessionDuration = sessions.length > 0 
      ? Math.round(totalDuration / sessions.length / 60000) 
      : 0;
    
    // è®¡ç®—æ¯æ¬¡å­¦ä¹ å®Œæˆå…³å¡æ•°
    const completions = events.filter(e => e.type === EVENTS.LEVEL_COMPLETE);
    const avgLevelsPerSession = sessions.length > 0 
      ? Math.round(completions.length / sessions.length * 10) / 10 
      : 0;
    
    // è®¡ç®—å‘¨å­¦ä¹ é¢‘ç‡
    const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
    const weekSessions = sessions.filter(s => s.timestamp >= oneWeekAgo);
    const uniqueDays = new Set(
      weekSessions.map(s => new Date(s.timestamp).toDateString())
    ).size;
    
    return {
      preferredHours,
      avgSessionDuration,
      avgLevelsPerSession,
      weeklyFrequency: uniqueDays
    };
  }

  /**
   * å¡ç‚¹åˆ†æ
   */
  async analyzeBottlenecks(userId?: string): Promise<BottleneckAnalysis[]> {
    const filter = userId ? { userId } : undefined;
    const events = await storageService.getEvents(filter);
    
    // æŒ‰å…³å¡åˆ†ç»„ç»Ÿè®¡
    const levelStats: Map<string, {
      starts: number;
      completes: number;
      fails: number;
      abandons: number;
      totalAttempts: number;
    }> = new Map();
    
    events.forEach(e => {
      if (![EVENTS.LEVEL_START, EVENTS.LEVEL_COMPLETE, EVENTS.LEVEL_FAIL, EVENTS.LEVEL_ABANDON].includes(e.type as any)) {
        return;
      }
      
      const key = `${e.data.courseId}-${e.data.levelId}`;
      const stats = levelStats.get(key) || {
        starts: 0, completes: 0, fails: 0, abandons: 0, totalAttempts: 0
      };
      
      switch (e.type) {
        case EVENTS.LEVEL_START:
          stats.starts++;
          break;
        case EVENTS.LEVEL_COMPLETE:
          stats.completes++;
          break;
        case EVENTS.LEVEL_FAIL:
          stats.fails++;
          stats.totalAttempts++;
          break;
        case EVENTS.LEVEL_ABANDON:
          stats.abandons++;
          break;
      }
      
      levelStats.set(key, stats);
    });
    
    // è½¬æ¢ä¸ºåˆ†æç»“æœå¹¶æ’åº
    return Array.from(levelStats.entries())
      .map(([key, stats]) => {
        const [courseId, levelId] = key.split('-');
        return {
          levelId: Number(levelId),
          courseId,
          failRate: stats.starts > 0 ? Math.round(stats.fails / stats.starts * 100) : 0,
          avgAttempts: stats.completes > 0 ? Math.round(stats.totalAttempts / stats.completes * 10) / 10 : 0,
          abandonRate: stats.starts > 0 ? Math.round(stats.abandons / stats.starts * 100) : 0
        };
      })
      .filter(a => a.failRate > 30 || a.abandonRate > 20) // åªè¿”å›æœ‰é—®é¢˜çš„å…³å¡
      .sort((a, b) => b.failRate - a.failRate);
  }

  /**
   * ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
   */
  async generateReport(userId: string): Promise<string> {
    const retention = await this.calculateRetention(userId);
    const habits = await this.analyzeLearningHabits(userId);
    const bottlenecks = await this.analyzeBottlenecks(userId);
    
    return `
## ğŸ“Š å­¦ä¹ æ•°æ®æŠ¥å‘Š

### ç•™å­˜æƒ…å†µ
- æ¬¡æ—¥ç•™å­˜: ${retention.d1}%
- 7æ—¥ç•™å­˜: ${retention.d7}%
- 30æ—¥ç•™å­˜: ${retention.d30}%

### å­¦ä¹ ä¹ æƒ¯
- åå¥½å­¦ä¹ æ—¶æ®µ: ${habits.preferredHours.map(h => `${h}:00`).join(', ')}
- å¹³å‡æ¯æ¬¡å­¦ä¹ æ—¶é•¿: ${habits.avgSessionDuration} åˆ†é’Ÿ
- å¹³å‡æ¯æ¬¡å®Œæˆå…³å¡: ${habits.avgLevelsPerSession} ä¸ª
- æœ¬å‘¨å­¦ä¹ å¤©æ•°: ${habits.weeklyFrequency} å¤©

### éœ€å…³æ³¨çš„å…³å¡
${bottlenecks.slice(0, 5).map(b => 
  `- ${b.courseId} Level ${b.levelId}: å¤±è´¥ç‡ ${b.failRate}%, æ”¾å¼ƒç‡ ${b.abandonRate}%`
).join('\n')}
    `.trim();
  }
}

export const analysisService = new AnalysisService();
```

### ğŸ“¤ Output
- `src/services/analysisService.ts`

---

## Step B.4: Zeabur æ•°æ®å¤‡ä»½æ–¹æ¡ˆ

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/components/settings/DataBackup.tsx
// ============================================================

import React, { useState } from 'react';
import { storageService } from '../../services/storageService';

const DataBackup: React.FC = () => {
  const [exporting, setExporting] = useState(false);
  const [importing, setImporting] = useState(false);

  // === å¯¼å‡ºæ•°æ® ===
  const handleExport = async () => {
    setExporting(true);
    try {
      const data = await storageService.exportAllData();
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `zlearn_backup_${new Date().toISOString().slice(0, 10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('å¯¼å‡ºå¤±è´¥:', error);
    } finally {
      setExporting(false);
    }
  };

  // === å¯¼å…¥æ•°æ® ===
  const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    setImporting(true);
    try {
      const text = await file.text();
      await storageService.importData(text);
      alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
    } catch (error) {
      console.error('å¯¼å…¥å¤±è´¥:', error);
      alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
    } finally {
      setImporting(false);
    }
  };

  return (
    <div className="p-6 bg-slate-800 rounded-xl space-y-6">
      <h3 className="text-xl font-bold">ğŸ’¾ æ•°æ®å¤‡ä»½</h3>
      
      {/* å¯¼å‡º */}
      <div>
        <h4 className="font-medium mb-2">å¯¼å‡ºæ•°æ®</h4>
        <p className="text-sm text-slate-400 mb-3">
          å°†å­¦ä¹ è¿›åº¦ã€è¯¾ç¨‹æ•°æ®ã€åˆ†ææ•°æ®å¯¼å‡ºä¸º JSON æ–‡ä»¶
        </p>
        <button
          onClick={handleExport}
          disabled={exporting}
          className="px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 rounded-lg"
        >
          {exporting ? 'å¯¼å‡ºä¸­...' : 'ğŸ“¥ å¯¼å‡ºå¤‡ä»½'}
        </button>
      </div>
      
      {/* å¯¼å…¥ */}
      <div>
        <h4 className="font-medium mb-2">æ¢å¤æ•°æ®</h4>
        <p className="text-sm text-slate-400 mb-3">
          ä»ä¹‹å‰å¯¼å‡ºçš„ JSON æ–‡ä»¶æ¢å¤æ•°æ®
        </p>
        <label className="inline-block px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg cursor-pointer">
          {importing ? 'å¯¼å…¥ä¸­...' : 'ğŸ“¤ é€‰æ‹©å¤‡ä»½æ–‡ä»¶'}
          <input
            type="file"
            accept=".json"
            onChange={handleImport}
            className="hidden"
          />
        </label>
      </div>
      
      {/* Zeabur å­˜å‚¨æç¤º */}
      <div className="p-4 bg-slate-700/50 rounded-xl">
        <h4 className="font-medium mb-2">â˜ï¸ Zeabur äº‘å­˜å‚¨ (å¯é€‰)</h4>
        <p className="text-sm text-slate-400 mb-2">
          å¯å°†å¤‡ä»½æ–‡ä»¶ä¸Šä¼ åˆ° Zeabur Object Storage å®ç°äº‘ç«¯å¤‡ä»½ï¼š
        </p>
        <ol className="text-sm text-slate-400 list-decimal list-inside space-y-1">
          <li>åœ¨ Zeabur æ§åˆ¶å°åˆ›å»º Object Storage æœåŠ¡</li>
          <li>è·å– Bucket åç§°å’Œ Access Key</li>
          <li>ä½¿ç”¨ S3 å…¼å®¹ API ä¸Šä¼ å¤‡ä»½æ–‡ä»¶</li>
        </ol>
        <a
          href="https://zeabur.com/docs/zh-CN/storage"
          target="_blank"
          rel="noopener noreferrer"
          className="inline-block mt-3 text-blue-400 hover:text-blue-300"
        >
          æŸ¥çœ‹ Zeabur å­˜å‚¨æ–‡æ¡£ â†’
        </a>
      </div>
    </div>
  );
};

export default DataBackup;
```

### Zeabur éƒ¨ç½²å¤‡ä»½æ–¹æ¡ˆ

```markdown
## Zeabur æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æœ¬åœ°å¯¼å‡º + æ‰‹åŠ¨ä¸Šä¼  (æ¨è MVP)
1. ç”¨æˆ·ç‚¹å‡»"å¯¼å‡ºå¤‡ä»½"ä¸‹è½½ JSON æ–‡ä»¶
2. æ‰‹åŠ¨ä¿å­˜åˆ°æœ¬åœ°æˆ–äº‘ç›˜
3. éœ€è¦æ¢å¤æ—¶é€‰æ‹©æ–‡ä»¶å¯¼å…¥

### æ–¹æ¡ˆ 2: Zeabur Object Storage (è¿›é˜¶)
1. åœ¨ Zeabur åˆ›å»º Object Storage æœåŠ¡
2. é…ç½®ç¯å¢ƒå˜é‡:
   - ZEABUR_STORAGE_BUCKET
   - ZEABUR_STORAGE_KEY
   - ZEABUR_STORAGE_SECRET
3. ä½¿ç”¨ S3 SDK è‡ªåŠ¨ä¸Šä¼ å¤‡ä»½

### æ–¹æ¡ˆ 3: å¤–éƒ¨æ•°æ®åº“ (ä¼ä¸šçº§)
1. ä½¿ç”¨ Zeabur çš„ PostgreSQL æœåŠ¡
2. å°† IndexedDB æ•°æ®åŒæ­¥åˆ°äº‘ç«¯
3. æ”¯æŒå¤šè®¾å¤‡åŒæ­¥
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### Phase A: å†…å®¹å¯¼å…¥ (3 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ importService.ts           # æ–°å¢ - PDF/MD/URL å¯¼å…¥
â”œâ”€â”€ courseGeneratorService.ts  # æ–°å¢ - AI è¯¾ç¨‹ç”Ÿæˆ

src/components/course/
â””â”€â”€ CourseCreator.tsx          # æ–°å¢ - è¯¾ç¨‹åˆ›å»ºå‘å¯¼
```

### Phase C: æ¸¸æˆåŒ–é…ç½®ç³»ç»Ÿ (5+ ä¸ªæ–‡ä»¶)
```
config/
â”œâ”€â”€ game.config.json           # æ–°å¢ - å…¨å±€æ¸¸æˆé…ç½®
â”œâ”€â”€ courses/
â”‚   â”œâ”€â”€ zeabur.course.json     # æ–°å¢ - Zeabur è¯¾ç¨‹é…ç½®
â”‚   â””â”€â”€ python.course.json     # æ–°å¢ - Python è¯¾ç¨‹é…ç½®

src/types/
â””â”€â”€ config.ts                  # æ–°å¢ - é…ç½®ç±»å‹å®šä¹‰

src/services/
â””â”€â”€ configService.ts           # æ–°å¢ - é…ç½®åŠ è½½æœåŠ¡

src/components/settings/
â””â”€â”€ ConfigEditor.tsx           # æ–°å¢ - é…ç½®ç¼–è¾‘å™¨ (å¯é€‰)
```

### Phase B: æ•°æ®åˆ†æ (4 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ storageService.ts          # æ–°å¢ - IndexedDB å°è£…
â”œâ”€â”€ analyticsService.ts        # æ–°å¢ - åŸ‹ç‚¹æ”¶é›†
â”œâ”€â”€ analysisService.ts         # æ–°å¢ - åˆ†æå¼•æ“

src/components/settings/
â””â”€â”€ DataBackup.tsx             # æ–°å¢ - æ•°æ®å¤‡ä»½UI
```

---

## â±ï¸ æ—¶é—´åˆ†é…

| æ­¥éª¤ | å†…å®¹ | é¢„ä¼° | ä¼˜å…ˆçº§ |
|-----|------|-----|-------|
| A.1 | å¯¼å…¥æœåŠ¡ | 45min | P0 |
| A.2 | AI ç”ŸæˆæœåŠ¡ | 60min | P0 |
| A.3 | åˆ›å»ºå‘å¯¼ UI | 60min | P0 |
| A.4 | åŠ¨æ€è¯¾ç¨‹ç®¡ç† | 30min | P1 |
| **C.1** | **è¯¾ç¨‹/å…³å¡é…ç½®æ–‡ä»¶è®¾è®¡** | **45min** | **P0** |
| **C.2** | **é…ç½®æœåŠ¡ (configService)** | **45min** | **P0** |
| **C.3** | **é…ç½®çƒ­åŠ è½½ä¸è¿ç§»** | **30min** | **P1** |
| **C.4** | **é…ç½®ç¼–è¾‘å™¨ UI** | **30min** | **P2** |
| B.1 | IndexedDB å­˜å‚¨ | 45min | P0 |
| B.2 | åŸ‹ç‚¹æ”¶é›† | 30min | P0 |
| B.3 | åˆ†æå¼•æ“ | 45min | P1 |
| B.4 | æ•°æ®å¤‡ä»½ | 30min | P1 |
| **æ€»è®¡** | | **8-10h** | |

---

## âœ… éªŒæ”¶æ¸…å•

### Phase A éªŒæ”¶
- [ ] å¯ä¸Šä¼  PDF å¹¶è§£ææ–‡æœ¬
- [ ] å¯ç²˜è´´ Markdown å¹¶è§£æ
- [ ] å¯è¾“å…¥ URL æŠ“å–ç½‘é¡µå†…å®¹
- [ ] é…ç½®ç•Œé¢å¯è®¾ç½®åœ°å›¾æ•°/å…³å¡æ•°/éš¾åº¦æ¨¡å¼
- [ ] AI å¯æ ¹æ®å†…å®¹ç”Ÿæˆè¯¾ç¨‹
- [ ] è‡ªå®šä¹‰è¯¾ç¨‹æ˜¾ç¤ºåœ¨è¯¾ç¨‹åˆ‡æ¢ Tab
- [ ] è‡ªå®šä¹‰è¯¾ç¨‹å¯æ­£å¸¸é—¯å…³

### Phase C éªŒæ”¶ (é…ç½®ç³»ç»Ÿ)
- [ ] `game.config.json` å¯æ­£ç¡®åŠ è½½
- [ ] è¯¾ç¨‹é…ç½®ä» JSON æ–‡ä»¶è¯»å– (éç¡¬ç¼–ç )
- [ ] å…³å¡é…ç½®æ”¯æŒéš¾åº¦é»˜è®¤å€¼ç»§æ‰¿
- [ ] `configService.get()` æ”¯æŒç‚¹å·è·¯å¾„è®¿é—®
- [ ] `configService.override()` å¯è¦†ç›–é…ç½®å¹¶æŒä¹…åŒ–
- [ ] æ˜Ÿæ˜Ÿè¯„åˆ†è§„åˆ™ä»é…ç½®è¯»å–
- [ ] è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å…³åŠŸèƒ½å¯é…ç½®
- [ ] é…ç½®ç¼–è¾‘å™¨å¯ä¿®æ”¹å‚æ•° (å¯é€‰)
- [ ] `constants.ts` è¯¾ç¨‹æ•°æ®è¿ç§»è‡³ JSON

### Phase B éªŒæ”¶
- [ ] IndexedDB å¯å­˜å‚¨åŸ‹ç‚¹äº‹ä»¶
- [ ] å…³å¡å¼€å§‹/å®Œæˆ/å¤±è´¥äº‹ä»¶æ­£ç¡®è®°å½•
- [ ] å¯å¯¼å‡ºå…¨éƒ¨æ•°æ®ä¸º JSON
- [ ] å¯ä» JSON æ¢å¤æ•°æ®
- [ ] ç•™å­˜åˆ†ææ•°æ®æ­£ç¡®è®¡ç®—
- [ ] å­¦ä¹ ä¹ æƒ¯åˆ†æç»“æœåˆç†

---

## ğŸš€ å¼€å§‹å¼€å‘

æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œï¼š

1. **Step C.1**: `config/game.config.json` + `config/courses/*.json` - é…ç½®æ–‡ä»¶ç»“æ„
2. **Step C.2**: `configService.ts` - é…ç½®åŠ è½½æœåŠ¡
3. **Step A.1**: `importService.ts` - å†…å®¹å¯¼å…¥æ ¸å¿ƒ
4. **Step B.1**: `storageService.ts` - æ•°æ®å­˜å‚¨åŸºç¡€
5. **Step A.2**: `courseGeneratorService.ts` - AI ç”Ÿæˆ
6. **Step B.2**: `analyticsService.ts` - åŸ‹ç‚¹æ”¶é›†
7. **Step A.3**: `CourseCreator.tsx` - åˆ›å»ºå‘å¯¼ UI
8. **Step C.3**: å°† `constants.ts` è¯¾ç¨‹æ•°æ®è¿ç§»è‡³ JSON
9. **Step B.3**: `analysisService.ts` - åˆ†æå¼•æ“
10. **Step A.4**: åŠ¨æ€è¯¾ç¨‹ç®¡ç†é›†æˆ
11. **Step B.4**: `DataBackup.tsx` - å¤‡ä»½ UI
12. **Step C.4**: `ConfigEditor.tsx` - é…ç½®ç¼–è¾‘å™¨ (å¯é€‰)

**å¼€å§‹å§ï¼** ğŸ¯

---

## ğŸ’¡ é…ç½®ç³»ç»Ÿæ ¸å¿ƒä»·å€¼

### ä¸ºä»€ä¹ˆè¦é…ç½®åŒ–ï¼Ÿ

| ç¡¬ç¼–ç æ–¹å¼ | é…ç½®åŒ–æ–¹å¼ |
|-----------|-----------|
| ä¿®æ”¹å…³å¡éœ€é‡æ–°æ„å»º | ä¿®æ”¹ JSON å³æ—¶ç”Ÿæ•ˆ |
| å‚æ•°æ•£è½åœ¨ä»£ç å„å¤„ | å‚æ•°é›†ä¸­ç®¡ç† |
| éæŠ€æœ¯äººå‘˜æ— æ³•è°ƒæ•´ | è¿è¥äººå‘˜å¯è‡ªåŠ©é…ç½® |
| A/B æµ‹è¯•å›°éš¾ | é…ç½®åˆ‡æ¢å³å¯æµ‹è¯• |
| æ¯ä¸ªè¯¾ç¨‹éœ€å†™ä»£ç  | å¤åˆ¶ JSON å³å¯åˆ›å»º |

### é…ç½®ç³»ç»Ÿè®¾è®¡åŸåˆ™

1. **æ•°æ®é©±åŠ¨**: å…³å¡å†…å®¹ã€éš¾åº¦å‚æ•°å…¨éƒ¨å¤–ç½®
2. **é»˜è®¤å€¼ç»§æ‰¿**: éš¾åº¦çº§åˆ« â†’ å…¨å±€é»˜è®¤ â†’ å…³å¡è¦†ç›–
3. **è¿è¡Œæ—¶è¦†ç›–**: ç”¨æˆ·å¯åœ¨è®¾ç½®ä¸­è°ƒæ•´ï¼Œå­˜å…¥ localStorage
4. **ç±»å‹å®‰å…¨**: TypeScript ç±»å‹å®šä¹‰ç¡®ä¿é…ç½®æ­£ç¡®
5. **çƒ­åŠ è½½**: æœªæ¥æ”¯æŒä¸é‡å¯åº”ç”¨åˆ·æ–°é…ç½®

