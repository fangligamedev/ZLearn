# 2025-11-27 开发进度摘要（内容导入 + 配置系统 + 数据分析）

## 完成情况
- **配置驱动课程/游戏参数**：新增 `config/game.config.json`、`config/courses/zeabur.course.json`（100 关）、`config/courses/python.course.json`，通过 `services/configService.ts` 加载。`types/config.ts` 定义配置类型。`App.tsx` 与课程选择已切换为配置驱动，可删除/新增自定义课程。
- **内容导入与 AI 课程生成**：实现 `services/importService.ts`（PDF/MD/URL 导入，含 pdfjs fallback）、`services/courseGeneratorService.ts`（Gemini 生成），新增向导 UI `components/course/CourseCreator.tsx` 并在头部按钮/地图页接入。
- **数据存储/埋点/分析基础**：`services/storageService.ts`（IndexedDB 事件/进度/会话/课程存储）、`services/analyticsService.ts`（埋点收集）、`services/analysisService.ts`（留存/习惯/卡点分析骨架），`App.tsx` 写入进度与事件。
- **运维工具 UI**：`components/settings/ConfigEditor.tsx`（运行时覆盖星星规则/自动跳转/朗读并持久化）、`components/settings/DataBackup.tsx`（导出/导入本地备份，Zeabur 存储指引）。头部增加入口。
- **API Key 配置**：`.env.local` 已填入 `GEMINI_API_KEY` 与 `VITE_GEMINI_API_KEY` 示例值（sk-ASF7dpKfeIAmBQdrgSNjQA），仅供本地调试。
- **构建通过**：`npm run build` 成功，新增依赖 `pdfjs-dist`（已安装）。

## 关键改动与文件索引
- 配置系统：`services/configService.ts`（get/override/watch、CourseConfig -> Course 映射、自定义课程注册/删除）、`types/config.ts`、`config/*`.
- 课程 UI：`components/LevelMap.tsx`（课程列表来自 config，可创建/删除自定义课程）、`App.tsx`（课程状态与概念进度改为 per-course map，头部按钮接入创建/配置/备份，埋点与进度写入）。
- 内容导入/生成：`services/importService.ts`（PDF/MD/URL）、`services/courseGeneratorService.ts`（Gemini 生成 maps/levels，需 API Key 与网络）、`components/course/CourseCreator.tsx`.
- 数据与分析：`services/storageService.ts`（IndexedDB 封装）、`services/analyticsService.ts`（事件队列/flush）、`services/analysisService.ts`（留存/习惯/卡点计算逻辑；尚未接 UI）、`components/settings/DataBackup.tsx`。
- 配置覆盖 UI：`components/settings/ConfigEditor.tsx`（星级规则、自动跳转、朗读设置）。
- 依赖：新增 `pdfjs-dist` 用于 PDF 解析；tsconfig 开启 `resolveJsonModule` 以导入 JSON 配置。

## 待验收要点
- 内容导入：PDF/Markdown/URL 抓取成功并生成课程，课程可显示/删除；AI 生成需网络与有效 API Key。
- 配置系统：星级规则、自动跳转、朗读在 ConfigEditor 修改后立即生效并持久化；课程列表来自配置（含自定义课程）。
- 数据：关卡完成/答题事件写入 IndexedDB，备份导出/导入可用（需浏览器支持）。

## 已知空缺/风险
- 分析结果 UI 未接入，仅有服务侧逻辑；未对接复盘面板。
- 概念课程进度目前仅存内存与自定义进度对象，未同步到 localStorage/IndexedDB（仅保存关卡完成事件）；刷新后需重新选择关卡。
- 旧 `constants.ts` 仍存在（代码关卡使用），概念课切换已改为配置驱动；后续可清理/迁移代码关卡数据到 JSON。
- AI 生成依赖 GEMINI_API_KEY 和网络；无网或 key 失效时向导会失败。
- PDF 解析依赖 `pdfjs-dist` 或 CDN fallback；如网络限制需本地依赖（已安装）。

## 部署/启动说明
- 本地调试：`npm run dev`（使用 `.env.local` 中的 GEMINI/VITE_GEMINI_API_KEY）。
- 预览构建：`npm run build` 后 `npx serve dist --listen 4173`。
- 外网部署：需提供目标（Zeabur/Vercel/Netlify 等）凭据；当前未上线公网。
